<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ 'Quick Scan Report' if scan_type == 'quick' else 'Full Scan Report' }} | {{ target }}</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #0b0c10;
            color: #c5c6c7;
            font-family: 'Courier New', monospace;
            padding: 30px 60px;
        }

        h1 {
            color: #66fcf1;
            font-size: 32px;
        }

        h2 {
            color: #45a29e;
            border-bottom: 1px solid #222;
            padding-bottom: 5px;
        }

        pre {
            background: #1f2833;
            padding: 15px;
            border-left: 5px solid #66fcf1;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-bottom: 30px;
            border-radius: 5px;
            box-shadow: 0 0 5px #000;
            color: #0f0;
        }

        .section {
            margin-top: 40px;
        }

        .footer {
            text-align: center;
            margin-top: 60px;
            color: #555;
            font-size: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #1f2833;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #444;
            padding: 10px;
            text-align: left;
            vertical-align: top;
        }

        th {
            background-color: #66fcf1;
            color: #0b0c10;
        }

        .low {
            color: #33ccff;
        }

        .medium {
            color: #ffa600;
        }

        .high {
            color: #ff073a;
        }

        a.button {
            padding: 10px 15px;
            background-color: #66fcf1;
            color: #000;
            text-decoration: none;
            border-radius: 5px;
            margin-right: 10px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <h1>üîç {{ 'Quick Scan Report' if scan_type == 'quick' else 'Full Scan Report' }} for {{ target }}</h1>

    <div style="margin-bottom: 20px;">
        <a href="/download/html" class="button">‚¨áÔ∏è Download HTML</a>
        <a href="/download/pdf" class="button">‚¨áÔ∏è Download PDF</a>
    </div>

    <div class="section">
        <h2>üìÑ WHOIS Information</h2>
        <pre>{{ whois }}</pre>
    </div>

    <div class="section">
        <h2>üåê NSLookup</h2>
        <pre>{{ nslookup }}</pre>
    </div>

    <div class="section">
        <h2>üì° Masscan (Top 1000 Ports)</h2>
        <pre>{{ masscan }}</pre>
    </div>

    <div class="section">
        <h2>üß™ DNSRecon (DNS Enumeration)</h2>
        <pre>{{ dnsrecon }}</pre>
    </div>

    {% if scan_type == 'full' %}
        <div class="section">
            <h2>üß† Wappalyzer (Web Technology Fingerprinting)</h2>
            <pre>{{ whatweb }}</pre>
        </div>

        <div class="section">
            <h2>üõ°Ô∏è SQLMap Results</h2>
            <pre>{{ sqlmap }}</pre>
        </div>

        <div class="section">
            <h2>‚ö†Ô∏è XSStrike (XSS Scanner)</h2>
            <pre>{{ xsstrike }}</pre>
        </div>

        {% if xsstrike_cves %}
        <div class="section">
            <h2>üìä Summary of CVEs (from XSStrike)</h2>
            <canvas id="xsstrikeChart" width="600" height="300"></canvas>

            <table>
                <thead>
                    <tr>
                        <th>CVE ID</th>
                        <th>Severity</th>
                        <th>Description</th>
                        <th>CVSS Score</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cve in xsstrike_cves %}
                    <tr>
                        <td>{{ cve.cve }}</td>
                        <td class="{{ cve.severity }}">{{ cve.severity | capitalize }}</td>
                        <td>{{ cve.description }}</td>
                        <td>{{ "%.2f"|format(cve.cvss) if cve.cvss is not none else 'N/A' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="section">
            <h2>üìä Summary of CVEs (from XSStrike)</h2>
            <p>No CVEs found in XSStrike results.</p>
        </div>
        {% endif %}
    {% else %}
        <div class="section">
            <h2>üß† Wappalyzer (Web Technology Fingerprinting)</h2>
            <pre>{{ whatweb }}</pre>
        </div>
    {% endif %}

    <div class="footer">
        Report generated by Recon Engine | All data shown is public OSINT.
    </div>

    {% if scan_type == 'full' and xsstrike_summary %}
    <script>
        const xsCtx = document.getElementById('xsstrikeChart').getContext('2d');
        const xsstrikeChart = new Chart(xsCtx, {
            type: 'bar',
            data: {
                labels: ['High', 'Medium', 'Low'],
                datasets: [{
                    label: 'Number of CVEs',
                    data: [
                        {{ xsstrike_summary.get('high', 0) }},
                        {{ xsstrike_summary.get('medium', 0) }},
                        {{ xsstrike_summary.get('low', 0) }}
                    ],
                    backgroundColor: [
                        '#ff073a',
                        '#ffa600',
                        '#33ccff'
                    ],
                    borderRadius: 5,
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            color: "#c5c6c7"
                        },
                        grid: {
                            color: "#1f2833"
                        }
                    },
                    x: {
                        ticks: {
                            color: "#c5c6c7"
                        },
                        grid: {
                            color: "#1f2833"
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: "#c5c6c7"
                        }
                    }
                }
            }
        });
    </script>
    {% endif %}
</body>
</html>

